generator client {
  provider = "prisma-client-js"
  // previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  // url      = env("DATABASE_URL")
}

model Player {
  id        Int          @id @default(autoincrement())
  nickname  String       @unique
  createdAt DateTime     @default(now())
  games     GamePlayer[]
  turns     Turn[]
}

model Game {
  id        Int          @id @default(autoincrement())
  type      String       @default("501")
  status    String       @default("IN_PROGRESS")
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt @default(now())
  players   GamePlayer[]
  sets      Set[]
}

model Set {
  id       Int      @id @default(autoincrement())
  gameId   Int
  winnerId Int?
  createdAt DateTime @default(now())
  game     Game     @relation(fields: [gameId], references: [id])
  legs     Leg[]
}

model Leg {
  id            Int      @id @default(autoincrement())
  setId         Int
  winnerId      Int?
  dartsToFinish Int? 
  createdAt     DateTime @default(now())   
  set           Set      @relation(fields: [setId], references: [id])
  turns         Turn[]
}

model Turn {
  id          Int      @id @default(autoincrement())
  legId       Int
  playerId    Int
  
  dart1       Int      @default(0)
  dart2       Int      @default(0)
  dart3       Int      @default(0)
  multiplier1 Int      @default(1)
  multiplier2 Int      @default(1)
  multiplier3 Int      @default(1)

  points      Int      
  remaining   Int?     
  isBust      Boolean  @default(false)
  dartsThrown Int      @default(3)
  
  createdAt   DateTime @default(now())

  darts       Dart[]

  leg         Leg      @relation(fields: [legId], references: [id])
  player      Player   @relation(fields: [playerId], references: [id])

  @@index([playerId, createdAt])
}

model Dart {
  id                Int     @id @default(autoincrement())
  turnId            Int
  value             Int     
  multiplier        Int     

  isCheckoutAttempt Boolean @default(false) 

  turn              Turn    @relation(fields: [turnId], references: [id], onDelete: Cascade)
}

model GamePlayer {
  gameId   Int
  playerId Int
  game     Game   @relation(fields: [gameId], references: [id])
  player   Player @relation(fields: [playerId], references: [id])

  @@id([gameId, playerId])
}