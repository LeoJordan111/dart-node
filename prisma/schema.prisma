generator client {
  provider = "prisma-client-js"
  // previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  // url      = env("DATABASE_URL")
}



model Player {
  id        Int          @id @default(autoincrement())
  nickname  String       @unique
  createdAt DateTime     @default(now())
  games     GamePlayer[]
  turns     Turn[]       
}

model Game {
  id        Int          @id @default(autoincrement())
  type      String       @default("501")
  status    String       @default("IN_PROGRESS")
  createdAt DateTime     @default(now())
  players   GamePlayer[]
  sets      Set[]
}

model Set {
  id       Int      @id @default(autoincrement())
  gameId   Int
  winnerId Int?
  game     Game     @relation(fields: [gameId], references: [id])
  legs     Leg[]
}

model Leg {
  id       Int      @id @default(autoincrement())
  setId    Int
  winnerId Int?
  set      Set      @relation(fields: [setId], references: [id])
  turns    Turn[]   
}

model Turn {
  id         Int      @id @default(autoincrement())
  legId      Int
  playerId   Int
  
  // Détail des 3 fléchettes
  dart1      Int      @default(0)
  dart2      Int      @default(0)
  dart3      Int      @default(0)
  
  // Multiplicateurs (1 = Simple, 2 = Double, 3 = Triple)
  multiplier1 Int     @default(1)
  multiplier2 Int     @default(1)
  multiplier3 Int     @default(1)

  points     Int      // Somme totale : (d1*m1) + (d2*m2) + (d3*m3)
  remaining  Int?     // Score restant après la volée
  isBust     Boolean  @default(false)

  dartsThrown Int      @default(3)
  
  leg        Leg      @relation(fields: [legId], references: [id])
  player     Player   @relation(fields: [playerId], references: [id])
}

model GamePlayer {
  gameId   Int
  playerId Int
  game     Game   @relation(fields: [gameId], references: [id])
  player   Player @relation(fields: [playerId], references: [id])

  @@id([gameId, playerId])
}